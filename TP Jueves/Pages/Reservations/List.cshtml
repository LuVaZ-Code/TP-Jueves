@page
@model TP_Jueves.Pages.Reservations.ListModel
@{
    ViewData["Title"] = "Mis Reservas";
}

<!-- HERO SECTION -->
<section class="hero" style="margin-bottom: 2rem;">
    <h1>?? Mis Reservas</h1>
    <p>Gestiona y ve el estado de todas tus reservas</p>
</section>

@if (!string.IsNullOrEmpty(Model.Message))
{
    <div class="alert alert-success alert-dismissible fade show" role="alert" style="border-radius: 12px; margin-bottom: 2rem;">
        @Model.Message
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (Model.Reservas.Any())
{
    <div style="display: grid; gap: 1.5rem; margin-bottom: 2rem;">
        @foreach (var reserva in Model.Reservas)
        {
            <div class="card" style="border-left: 6px solid @(reserva.Fecha.Date < DateTime.Today ? "#6c757d" : reserva.Fecha.Date == DateTime.Today ? "#ffc107" : "#28a745"); box-shadow: 0 2px 10px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s;" onclick="window.location.href='@Url.Page("Details", new { id = reserva.Id })'">
                <div class="card-body">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                        <!-- Información Principal -->
                        <div>
                            <h5 style="color: #2c3e50; margin-bottom: 1rem; font-weight: 700;">
                                @reserva.Restaurante?.Nombre ?? "Restaurante"
                            </h5>

                            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
                                <div>
                                    <p style="color: #7f8c8d; font-size: 0.9rem; margin: 0;">Fecha</p>
                                    <p style="font-weight: 600; margin: 0;">@reserva.Fecha.ToString("dd/MM/yyyy")</p>
                                </div>

                                <div>
                                    <p style="color: #7f8c8d; font-size: 0.9rem; margin: 0;">Horario</p>
                                    <p style="font-weight: 600; margin: 0;">@reserva.Horario</p>
                                </div>

                                <div>
                                    <p style="color: #7f8c8d; font-size: 0.9rem; margin: 0;">Personas</p>
                                    <p style="font-weight: 600; margin: 0;">@reserva.CantPersonas</p>
                                </div>
                            </div>
                        </div>

                        <!-- Estado -->
                        <div style="text-align: right;">
                            @if (reserva.Fecha.Date < DateTime.Today)
                            {
                                <span class="badge bg-secondary" style="font-size: 0.95rem; padding: 0.5rem 1rem; display: inline-block;">
                                    ? Pasada
                                </span>
                            }
                            else if (reserva.Fecha.Date == DateTime.Today)
                            {
                                <span class="badge bg-warning text-dark" style="font-size: 0.95rem; padding: 0.5rem 1rem; display: inline-block;">
                                    ? Hoy
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-success" style="font-size: 0.95rem; padding: 0.5rem 1rem; display: inline-block;">
                                    ? Confirmada
                                </span>
                            }
                        </div>
                    </div>

                    <!-- Detalles -->
                    <div style="background: #f9f9f9; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.9rem;">
                            <div>
                                <p style="color: #7f8c8d; margin: 0.5rem 0;">DNI</p>
                                <p style="margin: 0; font-weight: 600;">@reserva.DniCliente</p>
                            </div>

                            <div>
                                <p style="color: #7f8c8d; margin: 0.5rem 0;">Dieta</p>
                                <p style="margin: 0; font-weight: 600;">@reserva.Dieta</p>
                            </div>

                            @if (reserva.Mesa != null)
                            {
                                <div>
                                    <p style="color: #7f8c8d; margin: 0.5rem 0;">Mesa</p>
                                    <p style="margin: 0; font-weight: 600;">Mesa @reserva.Mesa.Id</p>
                                </div>
                            }

                            @if (reserva.Restaurante != null)
                            {
                                <div>
                                    <p style="color: #7f8c8d; margin: 0.5rem 0;">Contacto</p>
                                    <p style="margin: 0; font-weight: 600;">@reserva.Restaurante.Telefono</p>
                                </div>
                            }
                        </div>
                    </div>

                    <!-- Acciones -->
                    @if (reserva.Fecha.Date >= DateTime.Today)
                    {
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <a asp-page="Details" asp-route-id="@reserva.Id" class="btn btn-sm btn-info" style="flex: 1; min-width: 100px;">
                                Ver Detalles
                            </a>
                            <a asp-page="Cancel" asp-route-id="@reserva.Id" class="btn btn-sm btn-danger" style="flex: 1; min-width: 100px;" onclick="event.stopPropagation();">
                                Cancelar
                            </a>
                        </div>
                    }
                    else
                    {
                        <div style="display: flex; gap: 0.5rem;">
                            <a asp-page="Details" asp-route-id="@reserva.Id" class="btn btn-sm btn-info" style="flex: 1;">
                                Ver Detalles
                            </a>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
}
else
{
    <div style="text-align: center; padding: 3rem;">
        <div style="font-size: 3rem; margin-bottom: 1rem;">??</div>
        <div class="alert alert-warning" role="alert" style="display: inline-block; border-radius: 12px; background-color: #fff3cd; border: 1px solid #ffc107; padding: 1.5rem;">
            <p style="margin: 0; font-size: 1.1rem; color: #856404;">
                No tienes reservas aún. 
                <a asp-page="/Restaurants/Browse" style="font-weight: 600; color: #e74c3c;">¡Busca restaurantes y haz una!</a>
            </p>
        </div>
    </div>
}

<div style="margin-top: 2rem; text-align: center;">
    <a asp-page="/Index" class="btn btn-secondary">
        Volver al Inicio
    </a>
    <a asp-page="/Restaurants/Browse" class="btn btn-primary">
        Buscar Restaurante
    </a>
</div>
